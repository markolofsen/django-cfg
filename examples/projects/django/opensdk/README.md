# OpenSDK - Centrifugo WebSocket RPC Clients

Auto-generated type-safe clients for Centrifugo WebSocket RPC.

## ⚠️ Generated Code

**This directory is auto-generated. DO NOT EDIT manually.**

Changes will be overwritten on next generation.

## Generation

```bash
# Generate all clients (Python, TypeScript, Go)
make api

# Or directly
python manage.py generate_centrifugo_clients --output ./opensdk --all
```

## Structure

```
opensdk/
├── python/          # Python client (async)
│   ├── models.py          # Pydantic models
│   ├── rpc_client.py      # Base RPC client
│   ├── client.py          # Typed API wrapper
│   ├── requirements.txt   # Dependencies
│   └── README.md          # Usage docs
│
├── typescript/      # TypeScript client
│   ├── types.ts           # TypeScript interfaces
│   ├── rpc-client.ts      # Base RPC client
│   ├── client.ts          # Typed API wrapper
│   ├── package.json       # Dependencies
│   └── README.md          # Usage docs
│
└── go/              # Go client
    ├── types.go           # Go structs
    ├── rpc_client.go      # Base RPC client
    ├── client.go          # Typed API wrapper
    ├── go.mod             # Dependencies
    └── README.md          # Usage docs
```

## Quick Start

### Python

```bash
cd opensdk/python
pip install -r requirements.txt
```

```python
from opensdk.python import CentrifugoRPCClient, APIClient

rpc = CentrifugoRPCClient(
    url='ws://localhost:8000/connection/websocket',
    token='jwt-token',
    user_id='user-123'
)
await rpc.connect()

api = APIClient(rpc)
result = await api.some_method(params)
await rpc.disconnect()
```

### TypeScript

```bash
cd opensdk/typescript
npm install
```

```typescript
import { CentrifugoRPCClient, APIClient } from './opensdk/typescript';

const rpc = new CentrifugoRPCClient('ws://...', 'token', 'user-123');
await rpc.connect();

const api = new APIClient(rpc);
const result = await api.someMethod(params);
await rpc.disconnect();
```

### Go

```bash
cd opensdk/go
go mod tidy
```

```go
import client "path/to/opensdk/go"

api := client.NewAPIClient("ws://...", "token", "user-123")
api.Connect(ctx)
defer api.Disconnect()

result, err := api.SomeMethod(ctx, params)
```

## Features

✅ **Type-Safe**: Full type checking from Pydantic models
✅ **Async/Await**: Native async in all languages
✅ **Error Handling**: Timeout, exceptions, context cancellation
✅ **Auto-Generated**: From `@websocket_rpc` decorated handlers
✅ **IDE Support**: Full autocomplete and type hints
✅ **Correlation IDs**: Request-response matching over pub/sub

## Architecture

### Thin Wrapper Pattern

Each client has 2 layers:

1. **Base RPC Client** (`rpc_client.*`)
   - WebSocket connection management
   - Correlation ID pattern
   - Publish to `rpc.requests` channel
   - Subscribe to `user#{user_id}` channel
   - Match responses by correlation_id

2. **Typed API Client** (`client.*`)
   - Thin wrapper with typed methods
   - Auto-serialization/deserialization
   - One method per RPC endpoint

### Correlation ID Flow

```
Client                    Centrifugo                Server
  |                            |                        |
  |-- publish('rpc.requests')--|                        |
  |   {method, params,          |                        |
  |    correlation_id,          |                        |
  |    reply_to}                |                        |
  |                             |-- forward ----------->|
  |                             |                        |
  |                             |<-- publish to user# --|
  |<-- receive on user# --------|   {correlation_id,    |
  |    match by id              |    result}            |
```

## See Also

- [Centrifugo Documentation](https://centrifugal.dev/)
- [django-cfg Centrifugo App](../../../projects/django-cfg-dev/src/django_cfg/apps/centrifugo/)
- [Code Generation Docs](../../../projects/django-cfg-dev/src/django_cfg/apps/centrifugo/codegen/README.md)

---

**Auto-generated by `django_cfg.apps.centrifugo.codegen`**

Last updated: `make api`
