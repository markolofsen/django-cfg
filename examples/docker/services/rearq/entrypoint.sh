#!/bin/bash
# ============================================================================
# ReArq Worker Entrypoint Script
# ============================================================================

set -e

echo "═══════════════════════════════════════════════════════════════════"
echo "ReArq Worker Starting..."
echo "═══════════════════════════════════════════════════════════════════"

# ─────────────────────────────────────────────────────────────────
# Wait for dependencies
# ─────────────────────────────────────────────────────────────────

# Wait for Redis
echo "Waiting for Redis..."
while ! nc -z ${REARQ_REDIS_HOST:-redis} ${REARQ_REDIS_PORT:-6379}; do
  sleep 1
done
echo "✓ Redis is ready"

# ─────────────────────────────────────────────────────────────────
# Configuration
# ─────────────────────────────────────────────────────────────────

echo ""
echo "Configuration:"
echo "  Redis: ${REARQ_REDIS_HOST:-redis}:${REARQ_REDIS_PORT:-6379}/${REARQ_REDIS_DB:-1}"
echo ""

# ─────────────────────────────────────────────────────────────────
# Execute Command
# ─────────────────────────────────────────────────────────────────

echo "═══════════════════════════════════════════════════════════════════"
echo "Executing: $@"
echo "═══════════════════════════════════════════════════════════════════"

exec "$@"
