---
title: Next.js Setup
description: Create and configure a Next.js admin application for Django-CFG
---

import { Callout, FileTree } from 'nextra/components'

# Next.js Setup

Create a Next.js application that integrates with Django-CFG's admin system.

## Project Structure

<FileTree>
  <FileTree.Folder name="frontend/apps/admin" defaultOpen>
    <FileTree.Folder name="app" defaultOpen>
      <FileTree.Folder name="_core">
        <FileTree.File name="settings.ts" />
      </FileTree.Folder>
      <FileTree.Folder name="_layouts">
        <FileTree.File name="AppLayout.tsx" />
        <FileTree.File name="AdminLayout.tsx" />
        <FileTree.File name="PrivateLayout.tsx" />
      </FileTree.Folder>
      <FileTree.Folder name="_lib">
        <FileTree.Folder name="api">
          <FileTree.File name="BaseClient.ts" />
          <FileTree.Folder name="generated" />
        </FileTree.Folder>
      </FileTree.Folder>
      <FileTree.Folder name="_routes">
        <FileTree.File name="admin.ts" />
        <FileTree.File name="private.ts" />
      </FileTree.Folder>
      <FileTree.Folder name="(pages)">
        <FileTree.Folder name="admin">
          <FileTree.File name="layout.tsx" />
          <FileTree.File name="page.tsx" />
        </FileTree.Folder>
      </FileTree.Folder>
      <FileTree.File name="layout.tsx" />
      <FileTree.File name="page.tsx" />
    </FileTree.Folder>
    <FileTree.File name="package.json" />
    <FileTree.File name="next.config.ts" />
    <FileTree.File name="tsconfig.json" />
  </FileTree.Folder>
</FileTree>

## Core Files

### Settings

```typescript filename="app/_core/settings.ts"
export const settings = {
  apiBaseUrl: process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000',
  staticBuild: process.env.NEXT_PUBLIC_STATIC_BUILD === 'true',
};
```

### Root Layout

```tsx filename="app/layout.tsx"
import type { Metadata } from 'next';
import { Inter } from 'next/font/google';
import './globals.css';
import { AppLayout } from './_layouts/AppLayout';

const inter = Inter({ subsets: ['latin'] });

export const metadata: Metadata = {
  title: 'Admin Panel',
  description: 'Custom admin panel for Django-CFG',
};

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="en">
      <body className={inter.className}>
        <AppLayout>{children}</AppLayout>
      </body>
    </html>
  );
}
```

### App Layout (Authentication Provider)

```tsx filename="app/_layouts/AppLayout.tsx"
'use client';

import { useEffect, useState } from 'react';

interface AuthState {
  token: string | null;
  isAuthenticated: boolean;
}

export function AppLayout({ children }: { children: React.ReactNode }) {
  const [auth, setAuth] = useState<AuthState>({
    token: null,
    isAuthenticated: false,
  });

  useEffect(() => {
    // Check localStorage for tokens (injected by Django)
    const token = localStorage.getItem('auth_token');
    if (token) {
      setAuth({ token, isAuthenticated: true });
    }

    // Listen for postMessage from parent (Django Admin iframe)
    const handleMessage = (event: MessageEvent) => {
      if (event.data?.type === 'AUTH_TOKEN') {
        const { accessToken, refreshToken } = event.data;
        localStorage.setItem('auth_token', accessToken);
        localStorage.setItem('refresh_token', refreshToken);
        setAuth({ token: accessToken, isAuthenticated: true });
      }
    };

    window.addEventListener('message', handleMessage);
    return () => window.removeEventListener('message', handleMessage);
  }, []);

  return (
    <AuthContext.Provider value={auth}>
      {children}
    </AuthContext.Provider>
  );
}

// Create and export context
import { createContext, useContext } from 'react';

const AuthContext = createContext<AuthState>({
  token: null,
  isAuthenticated: false,
});

export const useAuth = () => useContext(AuthContext);
```

### Admin Layout

```tsx filename="app/_layouts/AdminLayout.tsx"
'use client';

import Link from 'next/link';
import { usePathname } from 'next/navigation';

interface MenuItem {
  label: string;
  href: string;
  icon?: React.ReactNode;
}

interface MenuGroup {
  title: string;
  items: MenuItem[];
}

const menuGroups: MenuGroup[] = [
  {
    title: 'Dashboard',
    items: [
      { label: 'Overview', href: '/admin' },
      { label: 'Analytics', href: '/admin/analytics' },
    ],
  },
  {
    title: 'Management',
    items: [
      { label: 'Items', href: '/admin/items' },
      { label: 'Users', href: '/admin/users' },
    ],
  },
];

export function AdminLayout({ children }: { children: React.ReactNode }) {
  const pathname = usePathname();

  return (
    <div className="flex min-h-screen">
      {/* Sidebar */}
      <aside className="w-64 bg-gray-900 text-white">
        <div className="p-4">
          <h1 className="text-xl font-bold">Admin Panel</h1>
        </div>
        <nav className="mt-4">
          {menuGroups.map((group) => (
            <div key={group.title} className="mb-4">
              <h2 className="px-4 text-xs font-semibold text-gray-400 uppercase">
                {group.title}
              </h2>
              <ul className="mt-2">
                {group.items.map((item) => (
                  <li key={item.href}>
                    <Link
                      href={item.href}
                      className={`block px-4 py-2 hover:bg-gray-800 ${
                        pathname === item.href ? 'bg-gray-800' : ''
                      }`}
                    >
                      {item.label}
                    </Link>
                  </li>
                ))}
              </ul>
            </div>
          ))}
        </nav>
      </aside>

      {/* Main content */}
      <main className="flex-1 bg-gray-100">
        <div className="p-6">{children}</div>
      </main>
    </div>
  );
}
```

### Admin Pages Layout with SWR

```tsx filename="app/(pages)/admin/layout.tsx"
'use client';

import { SWRConfig } from 'swr';
import { AdminLayout } from '@/app/_layouts/AdminLayout';

export default function AdminPagesLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <SWRConfig
      value={{
        revalidateOnFocus: false,
        revalidateOnReconnect: false,
        refreshInterval: 0,
        dedupingInterval: 10000,
      }}
    >
      <AdminLayout>{children}</AdminLayout>
    </SWRConfig>
  );
}
```

### Admin Dashboard Page

```tsx filename="app/(pages)/admin/page.tsx"
export default function AdminDashboard() {
  return (
    <div>
      <h1 className="text-2xl font-bold mb-6">Dashboard</h1>
      <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div className="bg-white p-6 rounded-lg shadow">
          <h3 className="text-gray-500 text-sm">Total Items</h3>
          <p className="text-3xl font-bold">0</p>
        </div>
        <div className="bg-white p-6 rounded-lg shadow">
          <h3 className="text-gray-500 text-sm">Active Users</h3>
          <p className="text-3xl font-bold">0</p>
        </div>
        <div className="bg-white p-6 rounded-lg shadow">
          <h3 className="text-gray-500 text-sm">Revenue</h3>
          <p className="text-3xl font-bold">$0</p>
        </div>
      </div>
    </div>
  );
}
```

## API Client Setup

### Base Client

```typescript filename="app/_lib/api/BaseClient.ts"
import { settings } from '@/app/_core/settings';

class ApiClient {
  private static instance: ApiClient;
  private baseUrl: string;

  private constructor() {
    this.baseUrl = settings.apiBaseUrl;
  }

  static getInstance(): ApiClient {
    if (!ApiClient.instance) {
      ApiClient.instance = new ApiClient();
    }
    return ApiClient.instance;
  }

  private getHeaders(): HeadersInit {
    const headers: HeadersInit = {
      'Content-Type': 'application/json',
    };

    const token = localStorage.getItem('auth_token');
    if (token) {
      headers['Authorization'] = `Bearer ${token}`;
    }

    return headers;
  }

  async fetch<T>(endpoint: string, options: RequestInit = {}): Promise<T> {
    const response = await fetch(`${this.baseUrl}${endpoint}`, {
      ...options,
      headers: {
        ...this.getHeaders(),
        ...options.headers,
      },
    });

    if (!response.ok) {
      throw new Error(`API Error: ${response.status}`);
    }

    return response.json();
  }
}

export const apiClient = ApiClient.getInstance();
```

## Next.js Configuration

### next.config.ts

```typescript filename="next.config.ts"
import type { NextConfig } from 'next';

const isStaticBuild = process.env.NEXT_PUBLIC_STATIC_BUILD === 'true';

const nextConfig: NextConfig = {
  // Enable static export for production builds
  ...(isStaticBuild && {
    output: 'export',
    trailingSlash: true,
    images: {
      unoptimized: true,
    },
  }),

  // Disable x-powered-by header
  poweredByHeader: false,

  // Strict mode for better development experience
  reactStrictMode: true,
};

export default nextConfig;
```

<Callout type="warning">
When `NEXT_PUBLIC_STATIC_BUILD=true`, Next.js generates static HTML files. Routes without `generateStaticParams()` won't be available in the static export.
</Callout>

### package.json Scripts

```json filename="package.json"
{
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "build:static": "NEXT_PUBLIC_STATIC_BUILD=true next build",
    "start": "next start",
    "lint": "next lint",
    "typecheck": "tsc --noEmit"
  }
}
```

## Static Export for Dynamic Routes

For routes with dynamic parameters, add `generateStaticParams`:

```tsx filename="app/(pages)/admin/items/[id]/page.tsx"
// This function is required for static export
export async function generateStaticParams() {
  // In static build, pre-render these specific IDs
  // For a real app, you might fetch this from an API during build
  return [
    { id: '1' },
    { id: '2' },
    { id: '3' },
  ];
}

export default function ItemPage({ params }: { params: { id: string } }) {
  return (
    <div>
      <h1>Item {params.id}</h1>
    </div>
  );
}
```
